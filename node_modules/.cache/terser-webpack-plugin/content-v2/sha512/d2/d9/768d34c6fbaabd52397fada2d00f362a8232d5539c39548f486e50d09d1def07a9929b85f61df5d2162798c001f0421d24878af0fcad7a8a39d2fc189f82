{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{786:function(e,t,a){\"use strict\";a.r(t),a.d(t,\"default\",(function(){return V}));var i=a(47),s=a(21),l=a.n(s),n=a(0),o=a.n(n),r=a(474),m=a(475),c=a(476),d=a(99),h=a.n(d),u=a(776),g=a(511),p=a(764),E=a(780),b=a(74),v=a(509),f=a(164),_=a(774),y=a(778),C=a(785),N=a(512),S=a(269),k=a(478),I=a(479),G=a(508);const w={labelCol:{style:{width:\"80px\"}},autoComplete:\"off\"};class O extends o.a.Component{constructor(e){super(e),this.formRef=o.a.createRef(),this.sizeFormRef=o.a.createRef(),this.formSpaceName=\"\",this.componentWillUnmount=()=>{this.setState=(e,t)=>{}},this.state=this.stateInit(),this.onSubmit=this.onSubmit.bind(this),this.onChangeValues=this.onChangeValues.bind(this),this.onAddSkuItem=this.onAddSkuItem.bind(this),this.handleCancel=this.handleCancel.bind(this),this.showDialog=this.showDialog.bind(this),this.getComponentRef=this.getComponentRef.bind(this),this.addClassOk=this.addClassOk.bind(this),this.getGoodsCategoryList=this.getGoodsCategoryList.bind(this),this.onAddGoodsHumbnailImg=this.onAddGoodsHumbnailImg.bind(this),this.onAddGoodsDetailImg=this.onAddGoodsDetailImg.bind(this),this.getGoodsSkuNode=this.getGoodsSkuNode.bind(this),this.memberChange=this.memberChange.bind(this),this.periodChange=this.periodChange.bind(this),this.handleChange=this.handleChange.bind(this),this.getGoodsSpec=this.getGoodsSpec.bind(this),this.specAddNmaeHandle=this.specAddNmaeHandle.bind(this),this.getSizeView=this.getSizeView.bind(this),this.sizeModelFinish=this.sizeModelFinish.bind(this),this.setSizeVal=this.setSizeVal.bind(this)}stateInit(){return{name:void 0,goods_type:m.d.substance,goods_sku:[],goods_category:void 0,detail:void 0,freight_price:0,stock_deduct:m.e.pay,limit_member:m.b.arbitrarily,limit_member_value:!1,limit_period_value:!1,limit_period:m.a.arbitrarily,goods_delivery_area:[],humbnail_img:[\"\"],detail_img:[\"\"],status:m.c.normal,previewVisible:!1,addClass:\"\",producSpecifications:\"\",categoryList:[],classKey:\"\",isCreate:!0,selectedItem:void 0,specificationsOpt:[],nameModalVisible:!1,sizeModalVisible:!1,sizeKey:void 0,editTbaleIndex:void 0,tableList:[]}}componentDidMount(){}getGoodsCategoryList(){return Object(i.a)(this,void 0,void 0,(function*(){const e=yield Object(S.c)();this.setState({categoryList:[].concat(e)})}))}createSku(){return{name:\"\",stock:void 0,original_price:void 0,cost_price:void 0,selling_price:void 0,image:\"\",limit_num:void 0}}onChangeValues(e){const t=Object.assign({},this.state);l.a.each(e,(e,a)=>{const i=this.transformData(a,e);h()(t,a,i)}),this.setState(t)}transformData(e,t){return t}onAddSkuItem(){const e=[].concat(this.state.goods_sku);e.push(this.createSku()),this.setState({goods_sku:e})}getFieldValue(e){if(this.formRef){const{current:t}=this.formRef;if(t&&t.getFieldValue){return t.getFieldValue(e)}}}getGoodsTtypeNode(){return o.a.createElement(u.a.Item,{name:\"goods_type\",label:\"商品信息\",rules:r.a},o.a.createElement(g.a.Group,null,o.a.createElement(g.a,{value:m.d.substance},o.a.createElement(\"span\",null,\"实物商品\")),o.a.createElement(g.a,{value:m.d.invented},o.a.createElement(\"span\",null,\"虚拟商品\"))))}getGoodsNameNode(){const e=this.state.name||\"\",t=o.a.createElement(\"span\",{className:\"font-gray\"},l.a.size(e),\"/\",20);return o.a.createElement(\"div\",{className:\"w350\"},o.a.createElement(u.a.Item,{name:\"name\",label:\"商品名称\",rules:r.a},o.a.createElement(p.a,{className:\"wmax\",placeholder:\"请输入商品名称\",maxLength:20,suffix:t})))}getGoodsCategoryNode(){return o.a.createElement(\"div\",{className:\"flex\"},o.a.createElement(\"div\",{className:\"w350\"},o.a.createElement(u.a.Item,{name:\"goods_category\",label:\"商品类目\",rules:r.a},o.a.createElement(E.a,{options:this.state.categoryList,fieldNames:{value:\"id\",label:\"name\",children:\"child\"},className:\"wmax\",placeholder:\"请输入商品名称\"}))),o.a.createElement(\"div\",null,o.a.createElement(\"div\",{className:\"ml20\"},o.a.createElement(b.a,{type:\"primary\",onClick:this.showDialog},\"添加类目\")),this.getAddClassNode()))}getCategoryView(){const{selectedItem:e,specificationsOpt:t}=this.state;return o.a.createElement(\"div\",null,o.a.createElement(v.a,{value:e,style:{width:200},placeholder:\"请选择商品规格\",onChange:this.handleChange},t.map(e=>o.a.createElement(v.a.Option,{key:e.spec_id,value:e.spec_id},e.spec_name))))}handleChange(e){this.setState({selectedItem:e})}getGoodsSpec(){return Object(i.a)(this,void 0,void 0,(function*(){const e=yield Object(S.g)(),t=l.a.each(e,e=>({spec_id:e.spec_id,spec_name:e.spec_name}));this.setState({specificationsOpt:[].concat(t)})}))}specAddNmaeHandle(e){this.setState({nameModalVisible:e})}addSizeHandle(e){this.state.selectedItem&&this.setState({sizeModalVisible:e,sizeKey:Math.random()})}onFinish(e){return Object(i.a)(this,void 0,void 0,(function*(){const{id:t}=yield Object(S.h)(e);t&&(this.specAddNmaeHandle(!1),this.getGoodsSpec(),f.b.success(\"添加成功\"))}))}getAddNmaeView(){return o.a.createElement(u.a,Object.assign({},G.b,{name:\"basic\",onFinish:e=>{this.onFinish(e)}}),o.a.createElement(u.a.Item,{label:\"规格名称\",name:\"spec_name\",rules:[{required:!0,message:\"请输入规格名称\"}]},o.a.createElement(p.a,null)),o.a.createElement(u.a.Item,Object.assign({},G.c),o.a.createElement(b.a,{type:\"primary\",htmlType:\"submit\"},\"确定\")))}sizeModelFinish(e){const t=this.state.tableList;e.spec_id=this.state.selectedItem,e.uid=Math.random(),0===this.state.editTbaleIndex||this.state.editTbaleIndex?(t[this.state.editTbaleIndex]=e,this.setState({tableList:[].concat(t),editTbaleIndex:void 0})):this.setState({tableList:[].concat(t,e)}),this.addSizeHandle(!1)}getSizeView(){return o.a.createElement(u.a,Object.assign({key:this.state.sizeKey,ref:this.sizeFormRef},G.b,{name:\"size\",onFinish:this.sizeModelFinish}),o.a.createElement(u.a.Item,{label:\"规格名称\",name:\"name\",rules:[{required:!0}]},o.a.createElement(p.a,{autoComplete:\"off\"})),o.a.createElement(u.a.Item,{label:\"成本价\",name:\"cost_price\",rules:[{required:!0}]},o.a.createElement(p.a,{autoComplete:\"off\"})),o.a.createElement(u.a.Item,{label:\"原价\",name:\"original_price\",rules:[{required:!0}]},o.a.createElement(p.a,{autoComplete:\"off\"})),o.a.createElement(u.a.Item,{label:\"售价\",name:\"selling_price\",rules:[{required:!0}]},o.a.createElement(p.a,{autoComplete:\"off\"})),o.a.createElement(u.a.Item,{label:\"库存\",name:\"stock\",rules:[{required:!0}]},o.a.createElement(p.a,{autoComplete:\"off\"})),o.a.createElement(u.a.Item,{label:\"实际销量\",name:\"sales\",rules:[{required:!0}]},o.a.createElement(p.a,{autoComplete:\"off\"})),o.a.createElement(u.a.Item,Object.assign({},G.c),o.a.createElement(b.a,{type:\"primary\",htmlType:\"submit\"},\"确定\")))}tableDel(e){let t;const a=this.state.tableList;for(let i=0;i<a.length;i++)if(e.id===a[i].id){t=i;break}a.splice(t,1),this.setState({tableList:[].concat(a)})}tableEdit(e){let t;this.addSizeHandle(!0);const a=this.state.tableList;for(let i=0;i<a.length;i++)if(e.id===a[i].id){t=i;break}this.setState({editTbaleIndex:t}),this.setSizeVal(a[t])}setSizeVal(e){setTimeout(()=>{this.sizeFormRef.current.setFieldsValue({name:e.name,cost_price:e.cost_price,original_price:e.original_price,selling_price:e.selling_price,stock:e.stock,sales:e.sales})},1e3)}getTable(){const e=[{title:\"规格名称\",dataIndex:\"name\"},{title:\"成本价\",dataIndex:\"cost_price\",render:e=>o.a.createElement(\"a\",null,\"￥\",e)},{title:\"原价\",dataIndex:\"original_price\",render:e=>o.a.createElement(\"a\",null,\"￥\",e)},{title:\"售价\",dataIndex:\"selling_price\",render:e=>o.a.createElement(\"a\",null,\"￥\",e)},{title:\"库存\",dataIndex:\"stock\"},{title:\"实际销量\",dataIndex:\"sales\"},{title:\"操作\",key:\"id\",render:(e,t)=>o.a.createElement(\"div\",null,o.a.createElement(\"a\",{className:\"mr20\",onClick:()=>this.tableEdit(t)},\"编辑\"),o.a.createElement(\"a\",{onClick:()=>this.tableDel(t)},\"删除\"))}];if(this.state.tableList&&this.state.tableList.length)return o.a.createElement(_.a,{bordered:!0,dataSource:this.state.tableList,columns:e,pagination:!1,rowKey:\"uid\",size:\"small\"})}getGoodsSkuNode(e){const t=this.state,a=`goods_sku[${e}].name`;let i;return 0===e&&(i=o.a.createElement(\"div\",{className:\"ml20\"},o.a.createElement(b.a,{type:\"primary\"},\"添加规格名称\"))),o.a.createElement(\"div\",null,o.a.createElement(\"div\",{className:\"flex\"},o.a.createElement(\"div\",{className:\"flex\"},o.a.createElement(u.a.Item,{name:a,label:e>0?\"\":\"规格名称\",rules:r.a},this.getCategoryView()),o.a.createElement(b.a,{className:\"ml20 mr20\",type:\"primary\",onClick:()=>{this.specAddNmaeHandle(!0)}},\"添加规格名称\"),o.a.createElement(b.a,{type:\"primary\",onClick:()=>{this.addSizeHandle(!0)}},\"添加规格值\")),i),o.a.createElement(y.a,{title:\"商品规格名称\",visible:t.nameModalVisible,footer:null,onCancel:()=>{this.specAddNmaeHandle(!1)}},this.getAddNmaeView()),o.a.createElement(\"div\",{className:\"mt20\"},o.a.createElement(y.a,{title:\"商品规格名称\",visible:t.sizeModalVisible,footer:null,onCancel:()=>{this.addSizeHandle(!1)}},this.getSizeView()),o.a.createElement(\"div\",{className:\"mt20\"},this.getTable())))}imageFileUploadSuccess(e){const t=[].concat(this.state[e]);t.push(\"\");const a={};a[e]=t,this.setState(a)}getGoodsHumbnailImg(e){console.log(e),console.log(this.state.humbnail_img);const t=`humbnail_img[${e}]`,a=0===e?\"商品缩略图\":void 0,i=this.state.humbnail_img;if(i&&i.length)return o.a.createElement(u.a.Item,{key:\"name\"+e,name:t,label:a,rules:r.a},o.a.createElement(k.a,{key:e,imgSrc:i[e]}))}onAddGoodsHumbnailImg(){const e=[].concat(this.state.humbnail_img,\"\");this.setState({humbnail_img:e})}getGoodsDetailImg(e){const t=this.state.detail_img,a=`detail_img[${e}]`,i=0===e?\"商品详情图\":void 0;if(t&&t.length)return o.a.createElement(u.a.Item,{key:\"name\"+e,name:a,label:i,rules:r.a},o.a.createElement(k.a,{key:e,imgSrc:t[e]}))}onAddGoodsDetailImg(){const e=[].concat(this.state.detail_img,\"\");this.setState({detail_img:e})}getGoodsDetailNode(){return this.state.isCreate||this.state.detail&&\"<p></p>\"!==this.state.detail?o.a.createElement(u.a.Item,{name:\"detail\",label:\"商品详情\",rules:r.a},o.a.createElement(I.a,{value:\"\"+this.state.detail})):void 0}getGoodsFreightPriceNode(){return o.a.createElement(\"div\",{className:\"flex\"},o.a.createElement(\"div\",null,o.a.createElement(u.a.Item,{name:\"freight_price\",label:\"统一邮费\",rules:r.a},o.a.createElement(C.a,null))),o.a.createElement(\"div\",{className:\"ml20\"},o.a.createElement(b.a,{type:\"primary\"},\"编辑配送地区\")))}getGoodsStockDeductNode(){return o.a.createElement(u.a.Item,{name:\"stock_deduct\"},o.a.createElement(N.a.Group,null,o.a.createElement(\"div\",null,o.a.createElement(N.a,{value:m.e.submit},o.a.createElement(\"span\",null,\"提交订单减库存方式\"))),o.a.createElement(\"div\",null,o.a.createElement(N.a,{value:m.e.pay},o.a.createElement(\"span\",{className:\"dibk align-top\"},o.a.createElement(\"span\",{className:\"dbk\"},o.a.createElement(\"span\",null,\"付款减库存方式\")),o.a.createElement(\"span\",{className:\"dbk\"},o.a.createElement(\"span\",null,\"商品参加“多人拼团”、“降价拍”活动时吗，默认付款减库存，参加“秒杀”活动时，默认为拍下清库存\")))))))}memberChange(e){this.setState({limit_member_value:e.target.checked})}periodChange(e){this.setState({limit_period_value:e.target.checked})}getGoodsLimitNode(){return o.a.createElement(\"div\",null,o.a.createElement(\"div\",{className:\"flex\"},o.a.createElement(\"div\",null,o.a.createElement(u.a.Item,{name:\"limit_member_value\"},o.a.createElement(N.a,{onChange:this.memberChange,checked:this.state.limit_member_value},\"只允许指定用户购买\"))),o.a.createElement(\"div\",{className:\"w200\"},o.a.createElement(u.a.Item,{name:\"limit_member\"},o.a.createElement(v.a,{showSearch:!0},o.a.createElement(v.a.Option,{value:\"1\"},\"用户1\"),o.a.createElement(v.a.Option,{value:\"2\"},\"用户2\"))))),o.a.createElement(\"div\",{className:\"flex\"},o.a.createElement(\"div\",null,o.a.createElement(u.a.Item,{name:\"limit_period_value\"},o.a.createElement(N.a,{onChange:this.periodChange,checked:this.state.limit_period_value},\"限购周期\"))),o.a.createElement(\"div\",{className:\"w200\"},o.a.createElement(u.a.Item,{name:\"limit_period\"},o.a.createElement(v.a,{showSearch:!0},o.a.createElement(v.a.Option,{value:\"1\"},\"周期1\"),o.a.createElement(v.a.Option,{value:\"2\"},\"周期2\"))))))}getGoodsStatusNode(){return o.a.createElement(u.a.Item,{name:\"status\",label:\"商品状态\",rules:r.a},o.a.createElement(g.a.Group,null,o.a.createElement(g.a,{value:m.c.normal},o.a.createElement(\"span\",null,\"立即上架\")),o.a.createElement(g.a,{value:m.c.prohibit},o.a.createElement(\"span\",null,\"暂不上架\"))))}getAddClassNode(){const e=this.state;return o.a.createElement(y.a,{title:\"添加类目\",visible:e.previewVisible,onOk:this.addClassOk,onCancel:this.handleCancel},o.a.createElement(c.a,{key:e.classKey,getComponentRef:this.getComponentRef}))}getFormContent(){const e=Object.assign(Object.assign({},w),{layout:\"horizontal\",ref:this.formRef,name:this.formSpaceName,onFinish:this.onSubmit,onValuesChange:this.onChangeValues});return o.a.createElement(u.a,Object.assign({},e),o.a.createElement(\"div\",null,o.a.createElement(\"div\",null,\"基础信息\"),o.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsTtypeNode(),this.getGoodsNameNode(),this.getGoodsCategoryNode())),o.a.createElement(\"div\",null,o.a.createElement(\"div\",null,\"商品规格\"),o.a.createElement(\"div\",{className:\"pt10\"},o.a.createElement(\"div\",null,this.getGoodsSkuNode(1)),o.a.createElement(\"div\",null,o.a.createElement(\"br\",null),o.a.createElement(\"br\",null),o.a.createElement(\"br\",null),o.a.createElement(\"br\",null))),o.a.createElement(\"div\",{className:\"pt20 flex\"},o.a.createElement(\"div\",{className:\"flex\"},l.a.map(this.state.humbnail_img,(e,t)=>o.a.createElement(\"div\",{key:t},this.getGoodsHumbnailImg(t))),o.a.createElement(\"div\",null,o.a.createElement(b.a,{onClick:this.onAddGoodsHumbnailImg},\"添加商品缩略图\")))),o.a.createElement(\"div\",{className:\"flex\"},o.a.createElement(\"div\",{className:\"flex\"},l.a.map(this.state.detail_img,(e,t)=>o.a.createElement(\"div\",{key:t},this.getGoodsDetailImg(t))),o.a.createElement(\"div\",null,o.a.createElement(b.a,{onClick:this.onAddGoodsDetailImg},\"添加商品详情图\")))),o.a.createElement(\"div\",{className:\"pt20\"},this.getGoodsDetailNode())),o.a.createElement(\"div\",null,o.a.createElement(\"div\",null,\"物流配置\"),o.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsFreightPriceNode())),o.a.createElement(\"div\",null,o.a.createElement(\"div\",null,\"库存扣减方式\"),o.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsStockDeductNode())),o.a.createElement(\"div\",null,o.a.createElement(\"div\",null,\"限购\"),o.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsLimitNode())),o.a.createElement(\"div\",null,o.a.createElement(\"div\",null,\"上下架\"),o.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsStatusNode())),o.a.createElement(\"div\",{className:\"pt20\"},o.a.createElement(u.a.Item,null,o.a.createElement(b.a,{type:\"primary\",htmlType:\"submit\"},\"保存\"))))}handleCancel(){this.setState({previewVisible:!1})}showDialog(){this.setState({classKey:Math.random(),previewVisible:!0})}getComponentRef(e,t){switch(e){case\"addClass\":this.setState({addClass:t});break;case\"category\":this.setState({producSpecifications:t})}}addClassOk(){console.log(\"1\")}render(){return o.a.createElement(\"div\",null,o.a.createElement(\"div\",null,this.getFormContent()))}}class V extends O{constructor(e){super(e)}componentDidMount(){const e=Object.create(null,{getGoodsSpec:{get:()=>super.getGoodsSpec},getGoodsCategoryList:{get:()=>super.getGoodsCategoryList}});return Object(i.a)(this,void 0,void 0,(function*(){e.getGoodsSpec.call(this),e.getGoodsCategoryList.call(this)}))}onSubmit(){return Object(i.a)(this,void 0,void 0,(function*(){let e=Object.assign({},l.a.cloneDeep(this.state));e.goods_category=l.a.last(e.goods_category),e.freight_price=100*e.freight_price,e.stock_deduct=l.a.first(e.stock_deduct),e.limit_member=l.a.first(e.limit_member),e.limit_period=l.a.first(e.limit_period),e.categoryList=JSON.stringify(e.categoryList),e.goods_sku=JSON.stringify(e.tableList),e.humbnail_img=\"\",e.detail_img=\"\",e=l.a.omit(e,[\"addClass\",\"producSpecifications\",\"tableList\",\"categoryList\",\"classKey\"]),console.log(e);const{id:t}=yield Object(S.a)(e)}))}}}}]);","extractedComments":[]}