{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{787:function(e,t,a){\"use strict\";a.r(t),a.d(t,\"default\",(function(){return L}));var i=a(47),s=a(21),l=a.n(s),n=a(269),o=a(111),m=a.n(o),r=a(0),c=a.n(r),d=a(474),h=a(475),u=a(476),g=a(99),p=a.n(g),E=a(776),v=a(511),b=a(764),_=a(780),y=a(74),C=a(785),f=a(512),N=a(509),k=a(778),G=a(478),S=a(479),I=a(508);const w={labelCol:{style:{width:\"80px\"}},autoComplete:\"off\"};class O extends c.a.Component{constructor(e){super(e),this.formRef=c.a.createRef(),this.formSpaceName=\"\",this.componentWillUnmount=()=>{this.setState=(e,t)=>{}},this.state=this.stateInit(),this.onSubmit=this.onSubmit.bind(this),this.onChangeValues=this.onChangeValues.bind(this),this.onAddSkuItem=this.onAddSkuItem.bind(this),this.handleCancel=this.handleCancel.bind(this),this.showDialog=this.showDialog.bind(this),this.getComponentRef=this.getComponentRef.bind(this),this.addClassOk=this.addClassOk.bind(this),this.getGoodsCategoryList=this.getGoodsCategoryList.bind(this),this.onAddGoodsHumbnailImg=this.onAddGoodsHumbnailImg.bind(this),this.onAddGoodsDetailImg=this.onAddGoodsDetailImg.bind(this),this.getGoodsSkuNode=this.getGoodsSkuNode.bind(this),this.memberChange=this.memberChange.bind(this),this.periodChange=this.periodChange.bind(this)}stateInit(){return{name:void 0,goods_type:h.d.substance,goods_sku:[],goods_category:void 0,detail:void 0,freight_price:0,stock_deduct:h.e.pay,limit_member:h.b.arbitrarily,limit_member_value:!1,limit_period_value:!1,limit_period:h.a.arbitrarily,goods_delivery_area:[],humbnail_img:[\"\"],detail_img:[\"\"],status:h.c.normal,previewVisible:!1,addClass:\"\",producSpecifications:\"\",categoryList:[],classKey:\"\",isCreate:!0}}componentDidMount(){this.getGoodsCategoryList()}getGoodsCategoryList(){return Object(i.a)(this,void 0,void 0,(function*(){const e=yield Object(n.c)();this.setState({categoryList:[].concat(e)})}))}createSku(){return{name:\"\",stock:void 0,original_price:void 0,cost_price:void 0,selling_price:void 0,image:\"\",limit_num:void 0}}onChangeValues(e){const t=Object.assign({},this.state);l.a.each(e,(e,a)=>{const i=this.transformData(a,e);p()(t,a,i)}),this.setState(t)}transformData(e,t){return t}onAddSkuItem(){const e=[].concat(this.state.goods_sku);e.push(this.createSku()),this.setState({goods_sku:e})}getFieldValue(e){if(this.formRef){const{current:t}=this.formRef;if(t&&t.getFieldValue){return t.getFieldValue(e)}}}getGoodsTtypeNode(){return c.a.createElement(E.a.Item,{name:\"goods_type\",label:\"商品信息\",rules:d.a},c.a.createElement(v.a.Group,null,c.a.createElement(v.a,{value:h.d.substance},c.a.createElement(\"span\",null,\"实物商品\")),c.a.createElement(v.a,{value:h.d.invented},c.a.createElement(\"span\",null,\"虚拟商品\"))))}getGoodsNameNode(){const e=this.state.name||\"\",t=c.a.createElement(\"span\",{className:\"font-gray\"},l.a.size(e),\"/\",20);return c.a.createElement(\"div\",{className:\"w350\"},c.a.createElement(E.a.Item,{name:\"name\",label:\"商品名称\",rules:d.a},c.a.createElement(b.a,{className:\"wmax\",placeholder:\"请输入商品名称\",maxLength:20,suffix:t})))}getGoodsCategoryNode(){return c.a.createElement(\"div\",{className:\"flex\"},c.a.createElement(\"div\",{className:\"w350\"},c.a.createElement(E.a.Item,{name:\"goods_category\",label:\"商品类目\",rules:d.a},c.a.createElement(_.a,{options:this.state.categoryList,fieldNames:{value:\"id\",label:\"name\",children:\"child\"},className:\"wmax\",placeholder:\"请输入商品名称\"}))),c.a.createElement(\"div\",null,c.a.createElement(\"div\",{className:\"ml20\"},c.a.createElement(y.a,{type:\"primary\",onClick:this.showDialog},\"添加类目\")),this.getAddClassNode()))}getGoodsSkuNode(e){let t;return 0===e&&(t=c.a.createElement(\"div\",{className:\"ml20\"},c.a.createElement(y.a,{type:\"primary\"},\"添加规格名称\"))),this.state.isCreate||this.state.goods_sku&&this.state.goods_sku.length?c.a.createElement(\"div\",null,c.a.createElement(I.a,{goods_sku:this.state.goods_sku,getComponentRef:this.getComponentRef})):void 0}imageFileUploadSuccess(e){const t=[].concat(this.state[e]);t.push(\"\");const a={};a[e]=t,this.setState(a)}getGoodsHumbnailImg(e){const t=`humbnail_img[${e}]`,a=0===e?\"商品缩略图\":void 0,i=this.state.humbnail_img;if(i&&i.length)return l.a.map(i,(e,i)=>c.a.createElement(E.a.Item,{key:\"name\"+i,name:t,label:a,rules:d.a},c.a.createElement(G.a,{key:i,imgSrc:e})))}onAddGoodsHumbnailImg(){const e=[].concat(this.state.humbnail_img,\"\");this.setState({humbnail_img:e})}getGoodsDetailImg(e){const t=this.state.detail_img,a=`detail_img[${e}]`,i=0===e?\"商品详情图\":void 0;if(t&&t.length)return l.a.map(t,(e,t)=>c.a.createElement(E.a.Item,{key:\"name\"+t,name:a,label:i,rules:d.a},c.a.createElement(G.a,{key:t,imgSrc:e})))}onAddGoodsDetailImg(){const e=[].concat(this.state.detail_img,\"\");this.setState({detail_img:e})}getGoodsDetailNode(){return this.state.isCreate||this.state.detail&&\"<p></p>\"!==this.state.detail?c.a.createElement(E.a.Item,{name:\"detail\",label:\"商品详情\",rules:d.a},c.a.createElement(S.a,{value:\"\"+this.state.detail})):void 0}getGoodsFreightPriceNode(){return c.a.createElement(\"div\",{className:\"flex\"},c.a.createElement(\"div\",null,c.a.createElement(E.a.Item,{name:\"freight_price\",label:\"统一邮费\",rules:d.a},c.a.createElement(C.a,null))),c.a.createElement(\"div\",{className:\"ml20\"},c.a.createElement(y.a,{type:\"primary\"},\"编辑配送地区\")))}getGoodsStockDeductNode(){return c.a.createElement(E.a.Item,{name:\"stock_deduct\"},c.a.createElement(f.a.Group,null,c.a.createElement(\"div\",null,c.a.createElement(f.a,{value:h.e.submit},c.a.createElement(\"span\",null,\"提交订单减库存方式\"))),c.a.createElement(\"div\",null,c.a.createElement(f.a,{value:h.e.pay},c.a.createElement(\"span\",{className:\"dibk align-top\"},c.a.createElement(\"span\",{className:\"dbk\"},c.a.createElement(\"span\",null,\"付款减库存方式\")),c.a.createElement(\"span\",{className:\"dbk\"},c.a.createElement(\"span\",null,\"商品参加“多人拼团”、“降价拍”活动时吗，默认付款减库存，参加“秒杀”活动时，默认为拍下清库存\")))))))}memberChange(e){this.setState({limit_member_value:e.target.checked})}periodChange(e){this.setState({limit_period_value:e.target.checked})}getGoodsLimitNode(){return c.a.createElement(\"div\",null,c.a.createElement(\"div\",{className:\"flex\"},c.a.createElement(\"div\",null,c.a.createElement(E.a.Item,{name:\"limit_member_value\"},c.a.createElement(f.a,{onChange:this.memberChange,checked:this.state.limit_member_value},\"只允许指定用户购买\"))),c.a.createElement(\"div\",{className:\"w200\"},c.a.createElement(E.a.Item,{name:\"limit_member\"},c.a.createElement(N.a,{showSearch:!0},c.a.createElement(N.a.Option,{value:\"1\"},\"用户1\"),c.a.createElement(N.a.Option,{value:\"2\"},\"用户2\"))))),c.a.createElement(\"div\",{className:\"flex\"},c.a.createElement(\"div\",null,c.a.createElement(E.a.Item,{name:\"limit_period_value\"},c.a.createElement(f.a,{onChange:this.periodChange,checked:this.state.limit_period_value},\"限购周期\"))),c.a.createElement(\"div\",{className:\"w200\"},c.a.createElement(E.a.Item,{name:\"limit_period\"},c.a.createElement(N.a,{showSearch:!0},c.a.createElement(N.a.Option,{value:\"1\"},\"周期1\"),c.a.createElement(N.a.Option,{value:\"2\"},\"周期2\"))))))}getGoodsStatusNode(){return c.a.createElement(E.a.Item,{name:\"status\",label:\"商品状态\",rules:d.a},c.a.createElement(v.a.Group,null,c.a.createElement(v.a,{value:h.c.normal},c.a.createElement(\"span\",null,\"立即上架\")),c.a.createElement(v.a,{value:h.c.prohibit},c.a.createElement(\"span\",null,\"暂不上架\"))))}getAddClassNode(){const e=this.state;return c.a.createElement(k.a,{title:\"添加类目\",visible:e.previewVisible,onOk:this.addClassOk,onCancel:this.handleCancel},c.a.createElement(u.a,{key:e.classKey,getComponentRef:this.getComponentRef}))}getFormContent(){const e=Object.assign(Object.assign({},w),{layout:\"horizontal\",ref:this.formRef,name:this.formSpaceName,onFinish:this.onSubmit,onValuesChange:this.onChangeValues});return c.a.createElement(E.a,Object.assign({},e),c.a.createElement(\"div\",null,c.a.createElement(\"div\",null,\"基础信息\"),c.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsTtypeNode(),this.getGoodsNameNode(),this.getGoodsCategoryNode())),c.a.createElement(\"div\",null,c.a.createElement(\"div\",null,\"商品规格\"),c.a.createElement(\"div\",{className:\"pt10\"},c.a.createElement(\"div\",null,this.getGoodsSkuNode(1)),c.a.createElement(\"div\",null,c.a.createElement(\"br\",null),c.a.createElement(\"br\",null),c.a.createElement(\"br\",null),c.a.createElement(\"br\",null))),c.a.createElement(\"div\",{className:\"pt20 flex\"},c.a.createElement(\"div\",{className:\"flex\"},l.a.map(this.state.humbnail_img,(e,t)=>c.a.createElement(\"div\",{key:t},this.getGoodsHumbnailImg(t))),c.a.createElement(\"div\",null,c.a.createElement(y.a,{onClick:this.onAddGoodsHumbnailImg},\"添加商品缩略图\")))),c.a.createElement(\"div\",{className:\"flex\"},c.a.createElement(\"div\",{className:\"flex\"},l.a.map(this.state.detail_img,(e,t)=>c.a.createElement(\"div\",{key:t},this.getGoodsDetailImg(t))),c.a.createElement(\"div\",null,c.a.createElement(y.a,{onClick:this.onAddGoodsDetailImg},\"添加商品详情图\")))),c.a.createElement(\"div\",{className:\"pt20\"},this.getGoodsDetailNode())),c.a.createElement(\"div\",null,c.a.createElement(\"div\",null,\"物流配置\"),c.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsFreightPriceNode())),c.a.createElement(\"div\",null,c.a.createElement(\"div\",null,\"库存扣减方式\"),c.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsStockDeductNode())),c.a.createElement(\"div\",null,c.a.createElement(\"div\",null,\"限购\"),c.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsLimitNode())),c.a.createElement(\"div\",null,c.a.createElement(\"div\",null,\"上下架\"),c.a.createElement(\"div\",{className:\"pt10\"},this.getGoodsStatusNode())),c.a.createElement(\"div\",{className:\"pt20\"},c.a.createElement(E.a.Item,null,c.a.createElement(y.a,{type:\"primary\",htmlType:\"submit\"},\"保存\"))))}handleCancel(){this.setState({previewVisible:!1})}showDialog(){this.setState({classKey:Math.random(),previewVisible:!0})}getComponentRef(e,t){switch(e){case\"addClass\":this.setState({addClass:t});break;case\"category\":this.setState({producSpecifications:t})}}addClassOk(){console.log(\"1\")}render(){return c.a.createElement(\"div\",null,c.a.createElement(\"div\",null,this.getFormContent()))}}class L extends O{onSubmit(){throw new Error(\"Method not implemented.\")}constructor(e){super(e),this.state={},this.getCategory=this.getCategory.bind(this)}getGoodsCategoryList(){return Object(i.a)(this,void 0,void 0,(function*(){const e=yield Object(n.c)();this.setState({categoryList:[].concat(e)})}))}componentDidMount(){const e=Object.create(null,{getGoodsCategoryList:{get:()=>super.getGoodsCategoryList}});return Object(i.a)(this,void 0,void 0,(function*(){e.getGoodsCategoryList.call(this),this.getGoodsCategoryList();const t=yield this.stateInit();if(this.setState(Object.assign({},t)),this.setState({categoryList:[].concat(this.state.categoryList)}),this.formRef){const{current:e}=this.formRef;e&&e.setFieldsValue(t)}e.getGoodsCategoryList.call(this),this.setState({detail:t.detail})}))}getCategory(e){const t=this.state.categoryList,a=new m.a([],\"id\").flatten(t,\"child\"),i=new m.a(a,\"id\",\"pid\"),s=l.a.first(i.select({id:e}));console.log(s);const n=l.a.first(i.select({id:s.pid||\"\"}));return n&&l.a.keys(n).length?[n.id]:[]}stateInit(){return Object(i.a)(this,void 0,void 0,(function*(){const e=this.props.location.query.id,t=yield Object(n.e)(e),a=this.getCategory(t.goods_category);console.log(t);const i={name:t.name,goods_type:t.goods_type,goods_sku:t.goods_sku,goods_category:[].concat(a,t.goods_category),detail:\"\"+t.detail,freight_price:t.freight_price/100,stock_deduct:[].concat(t.stock_deduct),limit_member:[].concat(t.limit_member+\"\"),limit_period:[].concat(t.limit_period+\"\"),goods_delivery_area:[],humbnail_img:[].concat(t.humbnail_img),detail_img:[].concat(t.detail_img),status:t.status,previewVisible:!1,addClass:\"\",categoryList:[],classKey:\"\",limit_member_value:!1,limit_period_value:!1,isCreate:!1};return console.log(i),t.limit_member?i.limit_member_value=!0:i.limit_member=[],t.limit_period?i.limit_period_value=!0:i.limit_period=[],console.log(i),i}))}}}}]);","extractedComments":[]}